<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LM3-PPA usage • rsofun</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="LM3-PPA usage">
<meta property="og:description" content="rsofun">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rsofun</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">4.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/lm3ppa_model_structure.html">LM3PPA model structure</a>
    </li>
    <li>
      <a href="../articles/lm3ppa_use.html">LM3-PPA usage</a>
    </li>
    <li>
      <a href="../articles/pmodel_use.html">P-model usage</a>
    </li>
    <li>
      <a href="../articles/prepare_forcing.html">Prepare forcing</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/computationales/rsofun/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="lm3ppa_use_files/header-attrs-2.7/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>LM3-PPA usage</h1>
                        <h4 class="author">Koen Hufkens</h4>
            
<<<<<<< HEAD
            <h4 class="date">2021-11-22</h4>
=======
>>>>>>> master
      
      <small class="dont-index">Source: <a href="https://github.com/computationales/rsofun/blob/master/vignettes/lm3ppa_use.Rmd"><code>vignettes/lm3ppa_use.Rmd</code></a></small>
      <div class="hidden name"><code>lm3ppa_use.Rmd</code></div>

    </div>

    
    
<p>The <code>rsofun</code> package and framework includes two main models. The <code>pmodel</code> and <code>lm3-ppa</code> (which in part relies on pmodel component). Here we give a short example on how to run the <code>lm3ppa</code> model on the included demo datasets to familiarize yourself with both the data structure and the outputs.</p>
<div id="demo-data" class="section level2">
<h2 class="hasAnchor">
<a href="#demo-data" class="anchor"></a>Demo data</h2>
<p>The package includes two demo datasets to run and validate pmodel output. These files can be directly loaded into your workspace by typing:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/computationales/rsofun">rsofun</a></span><span class="op">)</span>

<span class="va">lm3ppa_gs_leuning_drivers</span>
<span class="va">lm3ppa_p_model_drivers</span>
<span class="va">lm3ppa_validation</span></code></pre></div>
<p>These are real data from the Swiss CH-Lae fluxnet site. We can use these data to run the model, together with observations of GPP we can also parameterize <code>lm3ppa</code> parameters.</p>
</div>
<div id="two-model-approaches" class="section level1">
<h1 class="hasAnchor">
<a href="#two-model-approaches" class="anchor"></a>Two model approaches</h1>
<p>The LM3-PPA is a cohort-based vegetation model which simulates vegetation dynamics and biogeochemical processes (Weng et al., 2015). The model is able to link photosynthesis standard models (Farquhar et al., 1980) with tree allometry. In our formulation we retain the original model structure with the standard photosynthesis formulation (i.e. “gs_leuning”) as well as an alternative “p-model” approach. Both model structures operate at different time scales, where the original input has an hourly time step our alternative p-model approach uses a daily time step. Hence, we have two different datasets as driver data (with the lm3ppa p-model input being an aggregate of the high resolution hourly data).</p>
<div id="running-the-lm3-ppa-model-with-standard-photosynthesis" class="section level2">
<h2 class="hasAnchor">
<a href="#running-the-lm3-ppa-model-with-standard-photosynthesis" class="anchor"></a>Running the LM3-PPA model with standard photosynthesis</h2>
<p>With all data prepared we can run the model using <code><a href="../reference/runread_lm3ppa_f.html">runread_lm3ppa_f()</a></code>. This function takes the nested data structure and runs the model site by site, returning nested model output results matching the input drivers. In our case only one site will be evaluated.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># print parameter settings</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">lm3ppa_gs_leuning_drivers</span><span class="op">$</span><span class="va">params_siml</span><span class="op">)</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; # A tibble: 1 × 12</span>
<span class="co">#&gt;   spinup spinupyears recycle firstyeartrend nyeartrend outputhourly outputdaily</span>
<span class="co">#&gt;   &lt;lgl&gt;        &lt;dbl&gt;   &lt;dbl&gt;          &lt;dbl&gt;      &lt;dbl&gt; &lt;lgl&gt;        &lt;lgl&gt;      </span>
<span class="co">#&gt; 1 TRUE           250       1           2009          1 TRUE         TRUE       </span>
<span class="co">#&gt; # … with 5 more variables: do_U_shaped_mortality &lt;lgl&gt;,</span>
<span class="co">#&gt; #   update_annualLAImax &lt;lgl&gt;, do_closedN_run &lt;lgl&gt;, method_photosynth &lt;chr&gt;,</span>
<span class="co">#&gt; #   method_mortality &lt;chr&gt;</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">lm3ppa_gs_leuning_drivers</span><span class="op">$</span><span class="va">forcing</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; # A tibble: 8,760 × 13</span>
<span class="co">#&gt;     YEAR   DOY  HOUR    PAR Swdown   TEMP SoilT    RH      RAIN  WIND PRESSURE</span>
<span class="co">#&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt;  1  2009     1     0   8.17  0.156 0.728   3.16  91.6 0.0000184  3.56   93216.</span>
<span class="co">#&gt;  2  2009     1     1   8.16  0.158 0.780   3.20  91.5 0.0000116  3.37   93189.</span>
<span class="co">#&gt;  3  2009     1     2   8.17  0.162 0.519   3.23  93.2 0.0000116  3.01   93184.</span>
<span class="co">#&gt;  4  2009     1     3   8.15  0.152 0.476   3.28  92.5 0.0000116  3.31   93166.</span>
<span class="co">#&gt;  5  2009     1     4   8.21  0.158 0.336   3.30  92.9 0.0000140  3.23   93143.</span>
<span class="co">#&gt;  6  2009     1     5   8.20  0.161 0.278   3.30  93.8 0.0000140  2.94   93124.</span>
<span class="co">#&gt;  7  2009     1     6   8.18  0.161 0.0966  3.28  95.4 0.0000140  2.98   93114.</span>
<span class="co">#&gt;  8  2009     1     7   8.40  0.164 0.172   3.30  95.4 0.0000211  3.46   93111.</span>
<span class="co">#&gt;  9  2009     1     8  42.1   8.77  0.236   3.33  95.2 0.0000211  3.31   93118.</span>
<span class="co">#&gt; 10  2009     1     9 146.   38.7   0.152   3.41  96.1 0.0000211  3.27   93132.</span>
<span class="co">#&gt; # … with 8,750 more rows, and 2 more variables: aCO2_AW &lt;dbl&gt;, SWC &lt;dbl&gt;</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># run the model</span>
<span class="va">lm3ppa_output_leuning</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runread_lm3ppa_f.html">runread_lm3ppa_f</a></span><span class="op">(</span>
     <span class="va">lm3ppa_gs_leuning_drivers</span>,
     makecheck <span class="op">=</span> <span class="cn">TRUE</span>,
     parallel <span class="op">=</span> <span class="cn">FALSE</span>
     <span class="op">)</span>

<span class="co"># split out the annual data</span>
<span class="va">lm3ppa_gs_leuning_output</span> <span class="op">&lt;-</span> <span class="va">lm3ppa_gs_leuning_output</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">output_annual_tile</span></code></pre></div>
<div id="plotting-output" class="section level3">
<h3 class="hasAnchor">
<a href="#plotting-output" class="anchor"></a>Plotting output</h3>
<p>We can now visualize the model output.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># we only have one site so we'll unnest</span>
<span class="co"># the main model output</span>

<<<<<<< HEAD
<span class="va">df_output</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">output_annual_tile</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">GPP</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="st">"GPP"</span><span class="op">)</span></code></pre></div>
<p><img src="lm3ppa_use_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">df_output</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">output_annual_tile</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">plantC</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="st">"plantC"</span><span class="op">)</span></code></pre></div>
<p><img src="lm3ppa_use_files/figure-html/unnamed-chunk-3-2.png" width="700"></p>
=======
<span class="va">lm3ppa_gs_leuning_output</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">GPP</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="st">"GPP"</span><span class="op">)</span></code></pre></div>
<p><img src="lm3ppa_use_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">lm3ppa_gs_leuning_output</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">plantC</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="st">"plantC"</span><span class="op">)</span></code></pre></div>
<p><img src="lm3ppa_use_files/figure-html/unnamed-chunk-4-2.png" width="700"></p>
>>>>>>> master
</div>
</div>
<div id="running-the-lm3-ppa-model-with-p-model-photosynthesis" class="section level2">
<h2 class="hasAnchor">
<a href="#running-the-lm3-ppa-model-with-p-model-photosynthesis" class="anchor"></a>Running the LM3-PPA model with P-model photosynthesis</h2>
<p>Running the fast P-model implementation.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># print parameter settings</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">lm3ppa_p_model_drivers</span><span class="op">$</span><span class="va">params_siml</span><span class="op">)</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; # A tibble: 1 × 12</span>
<span class="co">#&gt;   spinup spinupyears recycle firstyeartrend nyeartrend outputhourly outputdaily</span>
<span class="co">#&gt;   &lt;lgl&gt;        &lt;dbl&gt;   &lt;dbl&gt;          &lt;dbl&gt;      &lt;dbl&gt; &lt;lgl&gt;        &lt;lgl&gt;      </span>
<span class="co">#&gt; 1 TRUE           250       1           2009          1 TRUE         TRUE       </span>
<span class="co">#&gt; # … with 5 more variables: do_U_shaped_mortality &lt;lgl&gt;,</span>
<span class="co">#&gt; #   update_annualLAImax &lt;lgl&gt;, do_closedN_run &lt;lgl&gt;, method_photosynth &lt;chr&gt;,</span>
<span class="co">#&gt; #   method_mortality &lt;chr&gt;</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">lm3ppa_p_model_drivers</span><span class="op">$</span><span class="va">forcing</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; # A tibble: 365 × 13</span>
<span class="co">#&gt;     YEAR   DOY  HOUR   PAR Swdown    TEMP SoilT    RH       RAIN  WIND PRESSURE</span>
<span class="co">#&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt;  1  2009     1  11.5 107.    28.0  0.384   3.39  93.7 0.0000166   3.00   93092.</span>
<span class="co">#&gt;  2  2009     2  11.5 102.    24.4 -1.64    2.55  92.5 0.0000232   2.97   93248.</span>
<span class="co">#&gt;  3  2009     3  11.5 197.    46.5 -2.51    1.95  85.1 0.00000371  2.84   93684.</span>
<span class="co">#&gt;  4  2009     4  11.5 139.    34.6 -1.82    2.20  83.5 0.0000130   2.67   93435.</span>
<span class="co">#&gt;  5  2009     5  11.5 154.    36.2 -1.34    2.23  87.8 0.0000223   3.21   93175.</span>
<span class="co">#&gt;  6  2009     6  11.5  99.2   25.9 -0.450   2.75  90.9 0.0000219   3.03   93282.</span>
<span class="co">#&gt;  7  2009     7  11.5 141.    34.8  0.266   3.50  89.7 0.0000136   2.64   93511.</span>
<span class="co">#&gt;  8  2009     8  11.5 169.    44.4  0.504   3.52  86.1 0.0000113   2.68   93443.</span>
<span class="co">#&gt;  9  2009     9  11.5 102.    25.3  0.0869  3.49  90.3 0.0000186   2.74   93447.</span>
<span class="co">#&gt; 10  2009    10  11.5 160.    40.5 -0.404   3.44  90.1 0.0000125   2.17   93633.</span>
<span class="co">#&gt; # … with 355 more rows, and 2 more variables: aCO2_AW &lt;dbl&gt;, SWC &lt;dbl&gt;</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># run the model</span>
<span class="va">lm3ppa_p_model_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runread_lm3ppa_f.html">runread_lm3ppa_f</a></span><span class="op">(</span>
     <span class="va">lm3ppa_p_model_drivers</span>,
     makecheck <span class="op">=</span> <span class="cn">TRUE</span>,
     parallel <span class="op">=</span> <span class="cn">FALSE</span>
     <span class="op">)</span>

<span class="co"># split out the annual data for visuals</span>
<span class="va">lm3ppa_p_model_output</span> <span class="op">&lt;-</span> <span class="va">lm3ppa_p_model_output</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">output_annual_tile</span></code></pre></div>
<div id="plotting-output-1" class="section level3">
<h3 class="hasAnchor">
<a href="#plotting-output-1" class="anchor"></a>Plotting output</h3>
<p>We can now visualize the model output.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># we only have one site so we'll unnest</span>
<span class="co"># the main model output</span>

<<<<<<< HEAD
<span class="va">df_output</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">output_annual_tile</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">GPP</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="st">"GPP"</span><span class="op">)</span></code></pre></div>
<p><img src="lm3ppa_use_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">df_output</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">output_annual_tile</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">plantC</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="st">"plantC"</span><span class="op">)</span></code></pre></div>
<p><img src="lm3ppa_use_files/figure-html/unnamed-chunk-5-2.png" width="700"></p>
=======
<span class="va">lm3ppa_p_model_output</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">GPP</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="st">"GPP"</span><span class="op">)</span></code></pre></div>
<p><img src="lm3ppa_use_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">lm3ppa_p_model_output</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">plantC</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="st">"plantC"</span><span class="op">)</span></code></pre></div>
<p><img src="lm3ppa_use_files/figure-html/unnamed-chunk-7-2.png" width="700"></p>
>>>>>>> master
</div>
</div>
<div id="calibrating-model-parameters" class="section level2">
<h2 class="hasAnchor">
<a href="#calibrating-model-parameters" class="anchor"></a>Calibrating model parameters</h2>
<p>To optimize new parameters based upon driver data and a validation dataset we must first specify an optimization strategy and settings, as well as parameter ranges.</p>
<<<<<<< HEAD
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>lm3ppa_gs_leuning_drivers<span class="sc">$</span>params_siml[[<span class="dv">1</span>]]<span class="sc">$</span>spinup <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>lm3ppa_gs_leuning_drivers<span class="sc">$</span>params_siml[[<span class="dv">1</span>]]<span class="sc">$</span>spinupyears <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Mortality as DBH</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>settings <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">method              =</span> <span class="st">"bayesiantools"</span>,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">targetvars          =</span> <span class="fu">c</span>(<span class="st">"gpp"</span>),</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">timescale           =</span> <span class="fu">list</span>(<span class="at">targets_obs =</span> <span class="st">"y"</span>),</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">sitenames           =</span> <span class="st">"CH-Lae"</span>,</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric              =</span> cost_rmse_lm3ppa_gsleuning,</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir_results         =</span> <span class="st">"./"</span>,</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">name                =</span> <span class="st">"ORG"</span>,</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">sampler =</span> <span class="st">"DEzs"</span>,</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">settings =</span> <span class="fu">list</span>(</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">burnin =</span> <span class="dv">10</span>,</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">iterations =</span> <span class="dv">50</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">par =</span> <span class="fu">list</span>(</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">phiRL =</span> <span class="fu">list</span>(<span class="at">lower=</span><span class="fl">0.5</span>, <span class="at">upper=</span><span class="dv">5</span>, <span class="at">init=</span><span class="fl">3.5</span>),</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">LAI_light =</span> <span class="fu">list</span>(<span class="at">lower=</span><span class="dv">2</span>, <span class="at">upper=</span><span class="dv">5</span>, <span class="at">init=</span><span class="fl">3.5</span>),</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">tf_base =</span> <span class="fu">list</span>(<span class="at">lower=</span><span class="fl">0.5</span>, <span class="at">upper=</span><span class="fl">1.5</span>, <span class="at">init=</span><span class="dv">1</span>),</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">par_mort =</span> <span class="fu">list</span>(<span class="at">lower=</span><span class="fl">0.1</span>, <span class="at">upper=</span><span class="dv">2</span>, <span class="at">init=</span><span class="dv">1</span>))</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>pars <span class="ot">&lt;-</span> <span class="fu">calib_sofun</span>(</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">drivers =</span> lm3ppa_gs_leuning_drivers,</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">obs =</span> lm3ppa_validation_2,</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">settings =</span> settings</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a> Running DEzs<span class="sc">-</span>MCMC, chain  <span class="dv">1</span> iteration <span class="dv">51</span> of <span class="dv">51</span> . Current logp  <span class="fl">6.755456</span> <span class="fl">6.755456</span> <span class="fl">6.755456</span> . Please wait<span class="sc">!</span> </span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; runMCMC terminated after 2.27seconds</span></span></code></pre></div>
=======
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Mortality as DBH</span>
<span class="va">settings</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  method              <span class="op">=</span> <span class="st">"bayesiantools"</span>,
  targetvars          <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"gpp"</span><span class="op">)</span>,
  timescale           <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>targets_obs <span class="op">=</span> <span class="st">"y"</span><span class="op">)</span>,
  sitenames           <span class="op">=</span> <span class="st">"CH-Lae"</span>,
  metric              <span class="op">=</span> <span class="va">cost_rmse_lm3ppa_gsleuning</span>,
  dir_results         <span class="op">=</span> <span class="st">"./"</span>,
  name                <span class="op">=</span> <span class="st">"ORG"</span>,
  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    sampler <span class="op">=</span> <span class="st">"DEzs"</span>,
    settings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
      burnin <span class="op">=</span> <span class="fl">10</span>,
      iterations <span class="op">=</span> <span class="fl">50</span>
    <span class="op">)</span>
  <span class="op">)</span>,
  par <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
       phiRL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>lower<span class="op">=</span><span class="fl">0.5</span>, upper<span class="op">=</span><span class="fl">5</span>, init<span class="op">=</span><span class="fl">3.5</span><span class="op">)</span>,
      LAI_light <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>lower<span class="op">=</span><span class="fl">2</span>, upper<span class="op">=</span><span class="fl">5</span>, init<span class="op">=</span><span class="fl">3.5</span><span class="op">)</span>,
      tf_base <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>lower<span class="op">=</span><span class="fl">0.5</span>, upper<span class="op">=</span><span class="fl">1.5</span>, init<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,
      par_mort <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>lower<span class="op">=</span><span class="fl">0.1</span>, upper<span class="op">=</span><span class="fl">2</span>, init<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calib_sofun.html">calib_sofun</a></span><span class="op">(</span>
  drivers <span class="op">=</span> <span class="va">lm3ppa_gs_leuning_drivers</span>,
  obs <span class="op">=</span> <span class="va">lm3ppa_validation_2</span>,
  settings <span class="op">=</span> <span class="va">settings</span>
<span class="op">)</span></code></pre></div>
>>>>>>> master
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Stocker Benjamin.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
